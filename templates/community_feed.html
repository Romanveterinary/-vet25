{% extends "base.html" %}
{% block title %}Стрічка спільноти{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="p-4 p-md-5 mb-4 rounded text-body-emphasis bg-body-secondary">
        <div class="col-lg-8 px-0">
            <h1 class="display-4 fst-italic">Загальна стрічка випадків</h1>
            <p class="lead my-3">Тут відображаються останні завантажені файли від усіх лікарів, згруповані за датою завантаження.</p>
        </div>
    </div>

    {% if grouped_photos %}
        {% for date, photos_on_day in grouped_photos %}
            <h2 class="pb-2 border-bottom mb-4 mt-5">
                {{ date | bilingual_date }}
            </h2>
            
            <div class="row row-cols-1 row-cols-md-3 g-4">
                {% for photo in photos_on_day %}
                <div class="col">
                    <div class="card h-100 shadow-sm">
                        <a href="{{ url_for('photo.view_details', photo_id=photo.id) }}">
                            
                            {% if photo.filepath.startswith('http') %}
                                <img src="{{ photo.filepath }}" class="card-img-top" style="height: 250px; object-fit: cover;" alt="Фото випадку">
                            {% else %}
                                <img src="{{ url_for('static', filename=photo.filepath) }}" class="card-img-top" style="height: 250px; object-fit: cover;" alt="Фото випадку">
                            {% endif %}
                            </a>
                        <div class="card-body">
                            <p class="card-text">
                                <small class="text-muted">Автор: <strong>{{ photo.user.username }}</strong></small><br>
                                {% if photo.enterprise %}
                                <small class="text-muted">Підприємство: <strong>{{ photo.enterprise.name }}</strong></small>
                                {% endif %}
                                {% if photo.animal_species and photo.organ_type %}
                                <br><strong class="text-primary">{{ photo.animal_species }} - {{ photo.organ_type }}</strong>
                                {% endif %}
                            </p>
                        </div>
                        <div class="card-footer bg-transparent border-top-0">
                            <a href="{{ url_for('photo.view_details', photo_id=photo.id) }}" class="btn btn-outline-primary w-100">
                                Переглянути обговорення ({{ photo.comments.count() }})
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% endfor %}
    {% else %}
        <div class="col-12">
            <p class="text-center text-muted fs-4 mt-5">У стрічці поки що немає записів.</p>
        </div>
    {% endif %}
</div>

{% if current_user.is_authenticated %}
<style>
/* ... ваші стилі для чату ... */
</style>
<div class="chat-widget">
</div>
<button class="chat-toggle-btn">?</button>
<script>
/* ... ваш скрипт для чату ... */
</script>
{% endif %}

{% endblock %}